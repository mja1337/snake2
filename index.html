<!DOCTYPE html>
<html>
<head>
    <style>
    #game-container {
	position: relative;
	height: 300px;
	width: 300px;
    }
    #game-board {
        position: relative;
        height: 300px;
        width: 300px;
        border: 1px solid black;
    }
    #game-over {
        position: absolute;
        top: 50%;
        left: 50%;
	transform: translate(-50%, -50%);
        width: 100%;
        text-align: center;
        font-size: 48px;
        color: red;
    }
	
    .dot {
        position: absolute;
        height: 20px;
        width: 20px;
        background-color: #000;
    }

    .food {
        position: absolute;
        height: 20px;
        width: 20px;
        background-color: #f00;
    }

    .poop {
        position: absolute;
        height: 20px;
        width: 20px;
        background-color: #964B00; /* Brown color */
    }

    .hidden {
        display: none;
    }

</style>
</head>
<body>
<div id="game-container">
    <div id="game-board"></div>
    <div id="game-over" class="hidden">Game Over</div>
</div>
    <button id="start-button">Start</button>
    <button id="reset-button">Reset</button>
    <div id="score">Score: 0</div>
    <script>
let dotSize = 20;
let gameBoardSize = 300;
let direction = 'right';
let snake = [{ top: 0, left: 0 }];
let poop = [];
let food = null;
let gameStarted = false;
let gameInterval = null;
let intervalDuration = 200; // initial speed
let score = 0

let gameBoard = document.getElementById('game-board');
let gameOverText = document.getElementById('game-over');
let scoreDisplay = document.getElementById('score');

function updateGame() {
if (!gameStarted) return;
    let head = Object.assign({}, snake[0]); // copy head
    switch (direction) {
        case 'right':
            head.left += dotSize;
            break;
        case 'down':
            head.top += dotSize;
            break;
        case 'left':
            head.left -= dotSize;
            break;
        case 'up':
            head.top -= dotSize;
            break;
    }

    // Game over conditions
    if (
        head.top < 0 || 
        head.left < 0 || 
        head.top === gameBoardSize || 
        head.left === gameBoardSize || 
        snake.find(dot => dot.top === head.top && dot.left === head.left) ||
        poop.find(dot => dot.top === head.top && dot.left === head.left)
    ) {
	gameStarted = false;
        return gameOver();
    }

    snake.unshift(head);

    if (food && food.top === head.top && food.left === head.left) {
        // Eat food
        food = null;
	// Increase score after eating
	score += 5;
        // Generate poop
        if (Math.random() < 0.33) {
            let lastDot = snake[snake.length - 1];
            poop.push(lastDot);
        }
	// Decrease the interval as the snake gets longer with a lower limit of 50ms
	intervalDuration = Math.max(50, 200 -- snake.length * 5);
	clearInterval(gameInterval);
	gameInterval = setInterval(updateGame, intervalDuration);
    } else {
        // Remove tail
        snake.pop();
    }

    // Randomly place food
    if (!food) {
    let newFood = {};
    do {
        newFood = {
            top: Math.floor(Math.random() * gameBoardSize / dotSize) * dotSize,
            left: Math.floor(Math.random() * gameBoardSize / dotSize) * dotSize,
        };
    } while (snake.find(dot => dot.top === newFood.top && dot.left === newFood.left));
    food = newFood;
}

    renderGame();
    scoreDisplay.textContent = 'Score: ' + score; // update score display
}

function gameOver() {
    clearInterval(gameInterval);
    gameOverText.classList.remove('hidden');
}

function renderGame() {
    // Clear old dots
    while (gameBoard.firstChild) {
        gameBoard.firstChild.remove();
    }

    // Draw snake
    snake.forEach(function(dot) {
        let dotElement = document.createElement('div');
        dotElement.style.top = `${dot.top}px`;
        dotElement.style.left = `${dot.left}px`;
        dotElement.classList.add('dot');
        gameBoard.appendChild(dotElement);
    });

    // Draw food
    let foodElement = document.createElement('div');
    foodElement.style.top = `${food.top}px`;
    foodElement.style.left = `${food.left}px`;
    foodElement.classList.add('food');
    gameBoard.appendChild(foodElement);

    // Draw poop
    poop.forEach(function(dot) {
        let poopElement = document.createElement('div');
        poopElement.style.top = `${dot.top}px`;
        poopElement.style.left = `${dot.left}px`;
        poopElement.classList.add('poop');
        gameBoard.appendChild(poopElement);
    });
}

function resetGame() {
    direction = 'right';
    snake = [{ top: 0, left: 0 }];
    poop = [];
    food = null;
    gameStarted = false;
    gameOverText.classList.add('hidden');
    if (typeof gameInterval !== 'undefined') clearInterval(gameInterval);
    score = 0; // reset score
    scoreDisplay.textContent = 'Score: ' + score; // update score display
}

	    
document.addEventListener('DOMContentLoaded', (event) => {
    let startButton = document.getElementById('start-button');
    startButton.addEventListener('click', function() {
	    gameStarted = true;
	    gameInterval = setInterval(updateGame, 200);
    });
    
    document.getElementById('reset-button').addEventListener('click', resetGame);
});

 window.addEventListener('keydown', function(e) {
    switch (e.key) {
        case 'ArrowUp':
            if (direction !== 'down') direction = 'up';
            break;
        case 'ArrowDown':
            if (direction !== 'up') direction = 'down';
            break;
        case 'ArrowLeft':
            if (direction !== 'right') direction = 'left';
            break;
        case 'ArrowRight':
            if (direction !== 'left') direction = 'right';
            break;
    }
});
</script>
</body>
</html>
